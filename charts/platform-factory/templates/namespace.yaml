{{- $components := values ( omit .Values.components "apps") -}}
{{- $istio := .Values.components.istio -}}

{{- range $components -}}
{{/* Remove components */}}
{{- if (kindIs "map" .namespace)  }}
{{- if and .namespace.create .enabled -}}
---
apiVersion: v1
kind: Namespace
metadata:
  name: {{ list . $ | include "platform-factory.format.namespace" }}
  labels:
    {{- include "platform-factory.labels" $ | nindent 4 }}
    {{- include "skyfjell.common.chartLabels" $ | nindent 4 }}
    {{- if and $istio.enabled $.Values.global.istioEnabled }}
    istio-injection: enabled
    {{- end }}
{{- end }}
{{- end }}
{{- end }}