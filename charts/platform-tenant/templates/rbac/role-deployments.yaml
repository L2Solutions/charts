{{- if .Values.components.rbac.enable -}}
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: {{ default (include "platform-tenant.fullname" .) .Values.targetNamespace.name }}
  name: {{ include "helper.deployerRoleName" .}}
rules:
  - apiGroups: ["", "extensions", "apps"]
    resources: ["*"]
    verbs: ["*"]
    {{- if .Values.components.flux.components.kustomization.create }}
  - apiGroups: ["kustomize.toolkit.fluxcd.io"]
    resources: ["kustomization"]
    resourceNames: 
      - {{ default (include "platform-tenant.fullname" .) .Values.components.flux.components.kustomization.name }}
    verbs:
      - get
    {{- end }}
  {{- with .Values.components.rbac.extraRules }}
    {{- toYaml . | nindent 2}}
  {{- end }}
{{- end -}}